# çº¢åŒ…DApp

ä¸€ä¸ªåŸºäºä»¥å¤ªåŠçš„æŠ¢çº¢åŒ…å»ä¸­å¿ƒåŒ–åº”ç”¨ï¼Œä½¿ç”¨Web3-React + Ethers.js + Solidityå¼€å‘ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- ğŸ’° åˆ›å»ºçº¢åŒ…ï¼ˆæ”¯æŒè®¾ç½®é‡‘é¢ã€æ•°é‡ã€ç¥ç¦è¯­ï¼‰
- ğŸ§§ æŠ¢çº¢åŒ…ï¼ˆéšæœºé‡‘é¢åˆ†é…ç®—æ³•ï¼‰
- ğŸ’³ è¿æ¥é’±åŒ…ï¼ˆMetaMaskï¼‰
- ğŸ“Š æŸ¥çœ‹çº¢åŒ…çŠ¶æ€ï¼ˆå‰©ä½™æ•°é‡ã€å·²é¢†å–è®°å½•ï¼‰
- ğŸš« é˜²é‡å¤é¢†å–æœºåˆ¶
- ğŸ”’ åˆ›å»ºè€…æ— æ³•é¢†å–è‡ªå·±çš„çº¢åŒ…

## ğŸ›  æŠ€æœ¯æ ˆ

- **å‰ç«¯**: React 18 + Web3-React + Ethers.js
- **æ™ºèƒ½åˆçº¦**: Solidity 0.8.19 + Truffle
- **æœ¬åœ°å¼€å‘**: Ganache CLI
- **æ ·å¼**: è‡ªå®šä¹‰CSSï¼ˆæ¸å˜è‰²ä¸»é¢˜ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 14.0.0
- npm >= 6.0.0
- MetaMaskæµè§ˆå™¨æ’ä»¶

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/kecan/red_packet_dapp.git
cd red_packet_dapp
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. å¯åŠ¨æœ¬åœ°åŒºå—é“¾

```bash
npm run ganache
```

### 4. ç¼–è¯‘å’Œéƒ¨ç½²åˆçº¦

```bash
# ç¼–è¯‘åˆçº¦
npm run compile

# éƒ¨ç½²åˆçº¦åˆ°æœ¬åœ°ç½‘ç»œ
npm run migrate
```

### 5. å¯åŠ¨å‰ç«¯åº”ç”¨

```bash
npm start
```

### ğŸš€ ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# ç»™å¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start-dev.sh

# ä¸€é”®å¯åŠ¨å¼€å‘ç¯å¢ƒ
./start-dev.sh
```

## âš™ï¸ MetaMaské…ç½®

### æ·»åŠ æœ¬åœ°ç½‘ç»œ

1. æ‰“å¼€MetaMask
2. ç‚¹å‡»ç½‘ç»œä¸‹æ‹‰èœå•
3. é€‰æ‹©"æ·»åŠ ç½‘ç»œ"
4. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **ç½‘ç»œåç§°**: Localhost 8545
   - **RPC URL**: http://localhost:8545
   - **é“¾ID**: 1337
   - **è´§å¸ç¬¦å·**: ETH

### å¯¼å…¥æµ‹è¯•è´¦æˆ·

Ganacheå¯åŠ¨åä¼šæä¾›10ä¸ªæµ‹è¯•è´¦æˆ·ï¼Œå¤åˆ¶ç§é’¥å¯¼å…¥åˆ°MetaMaskï¼š

```bash
# Ganacheä¼šæ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹çš„è´¦æˆ·ä¿¡æ¯
Available Accounts
==================
(0) 0x627306090abaB3A6e1400e9345bC60c78a8BEf57 (100 ETH)
(1) 0xf17f52151EbEF6C7334FAD080c5704D77216b732 (100 ETH)
...

Private Keys
==================
(0) 0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3
(1) 0xae6ae8e5ccbfb04590405997ee2d52d2b330726137b875053c36d94e974d162f
...
```

## ğŸ“– ä½¿ç”¨è¯´æ˜

### åˆ›å»ºçº¢åŒ…

1. è¿æ¥MetaMaské’±åŒ…
2. åœ¨"åˆ›å»ºçº¢åŒ…"å¡ç‰‡ä¸­å¡«å†™ï¼š
   - **çº¢åŒ…æ€»é‡‘é¢**: è¦å‘æ”¾çš„ETHæ€»é‡
   - **çº¢åŒ…æ•°é‡**: å¯é¢†å–çš„çº¢åŒ…ä¸ªæ•°ï¼ˆ1-100ï¼‰
   - **ç¥ç¦è¯­**: çº¢åŒ…çš„ç¥ç¦ä¿¡æ¯
3. ç‚¹å‡»"åˆ›å»ºçº¢åŒ…"æŒ‰é’®
4. åœ¨MetaMaskä¸­ç¡®è®¤äº¤æ˜“

### æŠ¢çº¢åŒ…

1. åœ¨"çº¢åŒ…åˆ—è¡¨"ä¸­æŸ¥çœ‹å¯ç”¨çš„çº¢åŒ…
2. ç‚¹å‡»çº¢åŒ…å¡ç‰‡ä¸Šçš„"ğŸ§§ æŠ¢çº¢åŒ…"æŒ‰é’®
3. åœ¨MetaMaskä¸­ç¡®è®¤äº¤æ˜“
4. æˆåŠŸåä¼šæ˜¾ç¤ºé¢†å–çš„é‡‘é¢

### çº¢åŒ…è§„åˆ™

- æ¯ä¸ªç”¨æˆ·åªèƒ½é¢†å–ä¸€æ¬¡åŒä¸€ä¸ªçº¢åŒ…
- åˆ›å»ºè€…æ— æ³•é¢†å–è‡ªå·±åˆ›å»ºçš„çº¢åŒ…
- çº¢åŒ…é‡‘é¢é‡‡ç”¨éšæœºåˆ†é…ç®—æ³•ï¼ˆæœ€åä¸€ä¸ªé¢†å–å‰©ä½™æ‰€æœ‰é‡‘é¢ï¼‰
- çº¢åŒ…é¢†å®ŒåçŠ¶æ€å˜ä¸º"å·²å®Œæˆ"

## ğŸ“ é¡¹ç›®ç»“æ„

```
red-packet-dapp/
â”œâ”€â”€ contracts/              # æ™ºèƒ½åˆçº¦
â”‚   â”œâ”€â”€ RedPacket.sol       # çº¢åŒ…ä¸»åˆçº¦
â”‚   â””â”€â”€ Migrations.sol      # Truffleè¿ç§»åˆçº¦
â”œâ”€â”€ migrations/             # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ 1_initial_migration.js
â”‚   â””â”€â”€ 2_deploy_red_packet.js
â”œâ”€â”€ src/                    # Reactå‰ç«¯
â”‚   â”œâ”€â”€ components/         # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ WalletConnection.js    # é’±åŒ…è¿æ¥
â”‚   â”‚   â”œâ”€â”€ CreateRedPacket.js     # åˆ›å»ºçº¢åŒ…
â”‚   â”‚   â””â”€â”€ RedPacketList.js       # çº¢åŒ…åˆ—è¡¨
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰Hook
â”‚   â”‚   â””â”€â”€ useRedPacketContract.js # åˆçº¦äº¤äº’
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ connectors.js   # Web3è¿æ¥å™¨
â”‚   â”œâ”€â”€ contracts/          # ç¼–è¯‘åçš„åˆçº¦ABI
â”‚   â”œâ”€â”€ App.js             # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ index.js           # Reactå…¥å£
â”‚   â””â”€â”€ index.css          # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”œâ”€â”€ truffle-config.js       # Truffleé…ç½®
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®
â””â”€â”€ start-dev.sh          # å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
```

## ğŸ”§ å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨Ganache
npm run ganache

# ç¼–è¯‘åˆçº¦
npm run compile

# éƒ¨ç½²åˆçº¦
npm run migrate

# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm start

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿è¡Œæµ‹è¯•
npm test

# ä¸€é”®å¯åŠ¨å¼€å‘ç¯å¢ƒ
npm run dev
```

## ğŸ§ª æ™ºèƒ½åˆçº¦åŠŸèƒ½

### ä¸»è¦æ–¹æ³•

- `createRedPacket(uint256 _totalCount, string memory _message)`: åˆ›å»ºçº¢åŒ…
- `claimRedPacket(uint256 _redPacketId)`: é¢†å–çº¢åŒ…
- `getRedPacketInfo(uint256 _redPacketId)`: è·å–çº¢åŒ…ä¿¡æ¯
- `hasClaimed(uint256 _redPacketId, address _user)`: æ£€æŸ¥æ˜¯å¦å·²é¢†å–
- `getClaimers(uint256 _redPacketId)`: è·å–é¢†å–è€…åˆ—è¡¨
- `getTotalRedPackets()`: è·å–çº¢åŒ…æ€»æ•°

### äº‹ä»¶

- `RedPacketCreated`: çº¢åŒ…åˆ›å»ºäº‹ä»¶
- `RedPacketClaimed`: çº¢åŒ…é¢†å–äº‹ä»¶
- `RedPacketExpired`: çº¢åŒ…è¿‡æœŸäº‹ä»¶

## âš ï¸ æ³¨æ„äº‹é¡¹

- æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œæ¼”ç¤ºï¼Œè¯·å‹¿åœ¨ä¸»ç½‘ä½¿ç”¨
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ETHä½™é¢è¿›è¡Œäº¤æ˜“
- æ™ºèƒ½åˆçº¦æœªç»å®¡è®¡ï¼Œç”Ÿäº§ç¯å¢ƒè¯·è°¨æ…ä½¿ç”¨
- Ganacheé‡å¯åéœ€è¦é‡æ–°éƒ¨ç½²åˆçº¦

## ğŸ› å¸¸è§é—®é¢˜

### 1. MetaMaskè¿æ¥å¤±è´¥
- ç¡®ä¿MetaMaskå·²å®‰è£…å¹¶è§£é”
- æ£€æŸ¥ç½‘ç»œé…ç½®æ˜¯å¦æ­£ç¡®
- å°è¯•åˆ·æ–°é¡µé¢

### 2. åˆçº¦äº¤äº’å¤±è´¥
- ç¡®ä¿Ganacheæ­£åœ¨è¿è¡Œ
- æ£€æŸ¥åˆçº¦æ˜¯å¦å·²æ­£ç¡®éƒ¨ç½²
- éªŒè¯è´¦æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿçš„ETH

### 3. äº¤æ˜“å¤±è´¥
- æ£€æŸ¥Gasè´¹ç”¨è®¾ç½®
- ç¡®è®¤äº¤æ˜“å‚æ•°æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

## ğŸ¨ ç•Œé¢é¢„è§ˆ

é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„æ¸å˜è‰²è®¾è®¡ï¼š
- ä¸»è‰²è°ƒï¼šç´«è‰²åˆ°è“è‰²æ¸å˜
- çº¢åŒ…å¡ç‰‡ï¼šç²‰è‰²æ¸å˜å¸¦é—ªå…‰åŠ¨æ•ˆ
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“® è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡GitHub Issuesè”ç³»ã€‚
